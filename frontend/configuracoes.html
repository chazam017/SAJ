<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Configura√ß√µes | SAJ</title>
  <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background-color: #c8b88a;
      color: #000;
    }
    .header {
      background-color: #771918;
      padding: 20px;
      text-align: center;
    }
    .header h1 {
      margin: 0;
      font-family: 'Archivo Black', sans-serif;
      color: #fff;
      font-size: 24px;
    }
    .container {
      max-width: 700px;
      margin: 40px auto;
      background-color: #fff;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      font-weight: 600;
      margin-top: 20px;
    }
    input[type="text"],
    input[type="url"],
    input[type="file"] {
      width: 100%;
      padding: 10px;
      border: 2px solid #771918;
      border-radius: 6px;
      margin-top: 8px;
      font-family: 'Poppins', sans-serif;
    }
    .button-group {
      margin-top: 30px;
      text-align: right;
    }
    .button {
      background-color: #18a843;
      color: #fff;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
    }
    .button:hover {
      background-color: #139034;
    }
    .back-link {
      display: inline-block;
      margin-top: 20px;
      color: #771918;
      text-decoration: none;
      font-weight: bold;
    }
    hr {
      margin: 40px 0;
      border: 1px solid #ccc;
    }
    h3 {
      margin-bottom: 10px;
      font-family: 'Archivo Black', sans-serif;
      color: #771918;
    }
    #listaTemplates {
      list-style: none;
      padding: 0;
    }
    #listaTemplates li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px dashed #ddd;
    }
    #listaTemplates li button {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 18px;
      color: #771918;
    }
    #uploadTemplateForm {
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <div class="header">
    <h1>Configura√ß√µes do Sistema</h1>
  </div>

  <div class="container">
    <!-- Formul√°rio de Configura√ß√µes Gerais -->
    <form id="configForm">
      <label for="apiUrl">URL da API FastAPI</label>
      <input type="url" id="apiUrl" name="apiUrl" placeholder="http://localhost:8000" required>

      <label for="tesseractPath">Caminho do Tesseract OCR</label>
      <input type="text" id="tesseractPath" name="tesseractPath" placeholder="C:\Program Files\Tesseract-OCR\tesseract.exe">

      <label for="popplerPath">Caminho do Poppler (pdftoppm)</label>
      <input type="text" id="popplerPath" name="popplerPath" placeholder="C:\poppler\Library\bin">

      <div class="button-group">
        <button type="submit" class="button">Salvar Configura√ß√µes</button>
      </div>
    </form>

    <hr>

    <!-- Gerenciamento de Templates -->
    <h3>Gerenciar Modelos de Templates</h3>
    <ul id="listaTemplates"></ul>

    <form id="uploadTemplateForm">
      <label for="newTemplate">Enviar Novo Template (.docx)</label>
      <input type="file" id="newTemplate" accept=".docx" required>
      <div class="button-group">
        <button type="submit" class="button">Enviar Template</button>
      </div>
    </form>

    <a href="index.html" class="back-link">‚Üê Voltar para In√≠cio</a>
  </div>

  <script>
    // IDs dos campos de configura√ß√£o
    const fields = ['apiUrl', 'tesseractPath', 'popplerPath'];

    // Ao carregar p√°gina, populate form e lista de templates
    document.addEventListener('DOMContentLoaded', () => {
      fields.forEach(id => {
        const el = document.getElementById(id);
        el.value = localStorage.getItem(id) || el.value;
      });
      carregarListaTemplates();
    });

    // Salvar configura√ß√µes no localStorage
    document.getElementById('configForm').addEventListener('submit', e => {
      e.preventDefault();
      fields.forEach(id => {
        localStorage.setItem(id, document.getElementById(id).value);
      });
      alert('Configura√ß√µes salvas!');
    });

    // Carrega lista de templates do backend
    async function carregarListaTemplates() {
      try {
        const res = await fetch('/templates');
        const data = await res.json();
        const ul = document.getElementById('listaTemplates');
        ul.innerHTML = '';
        data.templates.forEach(fn => {
          const li = document.createElement('li');
          li.textContent = fn;
          const btn = document.createElement('button');
          btn.textContent = 'üóëÔ∏è';
          btn.title = 'Excluir template';
          btn.onclick = () => deletarTemplate(fn);
          li.appendChild(btn);
          ul.appendChild(li);
        });
      } catch (err) {
        console.error('Erro ao listar templates', err);
      }
    }

    // Deletar template selecionado
    async function deletarTemplate(filename) {
      if (!confirm(`Excluir '${filename}'?`)) return;
      const res = await fetch(`/templates/${filename}`, { method: 'DELETE' });
      if (res.ok) carregarListaTemplates();
      else alert('Falha ao excluir template');
    }

    // Upload de novo template
    document.getElementById('uploadTemplateForm').addEventListener('submit', async e => {
      e.preventDefault();
      const fileInput = document.getElementById('newTemplate');
      const file = fileInput.files[0];
      if (!file) return alert('Selecione um arquivo .docx');
      const formData = new FormData();
      formData.append('template', file);

      const res = await fetch('/templates/upload', {
        method: 'POST',
        body: formData
      });
      if (res.ok) {
        alert('Template adicionado!');
        fileInput.value = '';
        carregarListaTemplates();
      } else {
        alert('Erro ao enviar template');
      }
    });
  </script>

</body>
</html>